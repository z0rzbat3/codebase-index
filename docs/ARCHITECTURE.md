# Codebase-Index: Technical Documentation

> Auto-generated by running `codebase-index` on itself

## Overview

**codebase-index** is a CLI tool that generates comprehensive, LLM-friendly inventories of codebases.

| Metric | Value |
|--------|-------|
| Total Files | 37 |
| Total Lines | 11,770 |
| Functions | 41 |
| Classes | 46 |
| Methods | 244 |
| Documentation Coverage | 40/41 (97%) |

## Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                              CLI                                    │
│                           (cli.py)                                  │
│  • Argument parsing        • Output formatting                      │
│  • Command dispatch        • Error handling                         │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
┌──────────────────────────────▼──────────────────────────────────────┐
│                         SCANNER                                      │
│                       (scanner.py)                                   │
│  • CodebaseScanner: Main orchestrator                               │
│  • File discovery & filtering                                       │
│  • Metadata aggregation (git, summary)                              │
└───────┬──────────────────────┬──────────────────────┬───────────────┘
        │                      │                      │
┌───────▼───────┐    ┌─────────▼─────────┐   ┌───────▼────────┐
│   PARSERS     │    │     SCANNERS      │   │   ANALYZERS    │
│ (parsers/)    │    │   (scanners/)     │   │ (analyzers/)   │
│               │    │                   │   │                │
│ • python.py   │    │ • dependencies.py │   │ • auth.py      │
│ • typescript  │    │ • env.py          │   │ • coupling.py  │
│ • sql.py      │    │ • todo.py         │   │ • impact.py    │
│ • docker.py   │    │ • routes.py       │   │ • semantic.py  │
│               │    │ • http_calls.py   │   │ • summaries.py │
│ Extract:      │    │ • middleware.py   │   │ • staleness.py │
│ - Functions   │    │ • websocket.py    │   │ • test_mapper  │
│ - Classes     │    │ • alembic.py      │   │ • schema_mapper│
│ - Imports     │    │                   │   │                │
│ - Routes      │    │ Extract:          │   │ Analyze:       │
│ - Models      │    │ - Dependencies    │   │ - Auth reqs    │
│ - Schemas     │    │ - Env vars        │   │ - Coupling     │
└───────────────┘    │ - TODOs           │   │ - Impact       │
                     │ - External calls  │   │ - Semantics    │
                     └───────────────────┘   └────────────────┘
                               │                      │
                     ┌─────────▼──────────────────────▼────────┐
                     │              CONFIG                      │
                     │            (config.py)                   │
                     │  • Default patterns (routes, models)     │
                     │  • YAML config loading                   │
                     │  • Framework-specific patterns           │
                     └─────────────────────────────────────────┘
```

## Module Details

### Core Modules

| Module | Purpose | Key Classes |
|--------|---------|-------------|
| `cli.py` | Entry point, arg parsing | `main()`, `create_parser()` |
| `scanner.py` | Orchestrates scanning | `CodebaseScanner` |
| `config.py` | Patterns & config loading | `load_config()`, `DEFAULT_CONFIG` |
| `incremental.py` | Fast re-scanning | `IncrementalUpdater` |
| `call_graph.py` | Call graph queries | `cg_query_function()`, `cg_query_callers()` |

### Parsers (parsers/)

| Parser | Extensions | Method |
|--------|------------|--------|
| `PythonParser` | `.py`, `.pyw` | AST parsing |
| `TypeScriptParser` | `.ts`, `.tsx`, `.js`, `.jsx` | Regex patterns |
| `SQLParser` | `.sql` | Regex patterns |
| `DockerParser` | `docker-compose.yml` | YAML parsing |

### Scanners (scanners/)

| Scanner | Detects |
|---------|---------|
| `DependenciesScanner` | requirements.txt, package.json, pyproject.toml |
| `EnvScanner` | Environment variable usage |
| `TodoScanner` | TODO, FIXME, HACK comments |
| `RoutePrefixScanner` | FastAPI router prefixes |
| `HttpCallsScanner` | External HTTP calls |
| `MiddlewareScanner` | Middleware configuration |
| `WebSocketScanner` | WebSocket endpoints |
| `AlembicScanner` | Database migrations |

### Analyzers (analyzers/)

| Analyzer | CLI Flag | Purpose |
|----------|----------|---------|
| `AuthScanner` | (auto) | Auth requirements per endpoint |
| `CouplingAnalyzer` | `--coupled-with` | File coupling analysis |
| `ImpactAnalyzer` | `--impact` | Change impact radius |
| `SemanticSearcher` | `--search` | Code search by concept |
| `SummaryGenerator` | `--generate-summaries` | LLM-generated descriptions |
| `StalenessChecker` | `--check` | Index freshness |
| `TestMapper` | `--tests-for` | Symbol-to-test mapping |
| `SchemaMapper` | `--schema` | Schema-to-endpoint mapping |

## Data Flow

```
1. CLI parses arguments
       │
2. CodebaseScanner initializes
       │
3. File discovery (respects exclusions)
       │
4. For each file:
       ├─► Parser extracts structure (AST/regex)
       ├─► Scanners detect patterns (deps, env, etc.)
       └─► Analyzers compute metrics (auth, complexity)
       │
5. Aggregation:
       ├─► Symbol index built
       ├─► Call graph constructed
       ├─► Duplicates detected
       └─► Coverage mapped
       │
6. Output JSON to stdout/file
```

## Output Schema

```json
{
  "meta": { "generated_at", "tool_version", "git" },
  "summary": { "total_files", "total_lines", "by_language", ... },
  "files": [{ "path", "language", "hash", "exports": {...} }],
  "api_endpoints": [{ "method", "path", "auth_required" }],
  "database": { "tables": [...] },
  "symbol_index": { "functions", "classes", "methods" },
  "call_graph": { "file:func": { "calls": [...] } },
  "test_coverage": { "source_to_test": {...} },
  "import_analysis": { "missing", "unused" },
  "semantic": { "embeddings", "symbols" },  // if --build-embeddings
  "summaries": { "cache", "stats" }          // if --generate-summaries
}
```

